<div class="page-container fade-in">
    <div class="page-header">
        <div>
            <h1 class="page-title">Gestão da Home</h1>
            <p class="page-subtitle">Configure os banners rotativos da página principal.</p>
        </div>
        <button class="mt-20" nz-button nzType="primary" (click)="showAddModal()">
            <span nz-icon nzType="plus"></span>
            Novo Banner
        </button>
    </div>

    <!-- Banners List -->
    <div class="table-card">
        <nz-table #bannerTable [nzData]="banners" [nzBordered]="false" [nzShowPagination]="false"
            [nzLoading]="isLoading" nzSize="middle">
            <thead>
                <tr>
                    <th nzWidth="140px">Visualização</th>
                    <th>Título</th>
                    <th>Subtítulo</th>
                    <th nzWidth="100px" nzAlign="center">Status</th>
                    <th nzWidth="120px" nzAlign="center">Ações</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of bannerTable.data; trackBy: trackByBannerId">
                    <td>
                        <div class="banner-preview">
                            <img [src]="data.imageUrl" alt="Banner" />
                        </div>
                    </td>
                    <td>{{ data.title || '-' }}</td>
                    <td>{{ data.subtitle || '-' }}</td>
                    <td nzAlign="center">
                        <nz-tag [nzColor]="data.isActive ? 'green' : 'default'">
                            {{ data.isActive ? 'Ativo' : 'Inativo' }}
                        </nz-tag>
                    </td>
                    <td nzAlign="center">
                        <button nz-button nzType="text" nzSize="small" (click)="showEditModal(data)" nz-tooltip
                            nzTooltipTitle="Editar">
                            <span nz-icon nzType="edit"></span>
                        </button>
                        <button nz-button nzType="text" nzSize="small" (click)="toggleStatus(data)" nz-tooltip
                            [nzTooltipTitle]="data.isActive ? 'Desativar' : 'Ativar'">
                            <span nz-icon [nzType]="data.isActive ? 'eye-invisible' : 'eye'"></span>
                        </button>
                        <button nz-button nzType="text" nzDanger nzSize="small" (click)="removeBanner(data._id)"
                            nz-tooltip nzTooltipTitle="Excluir">
                            <span nz-icon nzType="delete"></span>
                        </button>
                    </td>
                </tr>
            </tbody>
        </nz-table>

        <div *ngIf="banners.length === 0 && !isLoading" class="empty-state">
            <span nz-icon nzType="inbox" class="empty-icon"></span>
            <p>Nenhum banner cadastrado.</p>
            <button nz-button nzType="primary" (click)="showAddModal()">
                <span nz-icon nzType="plus"></span>
                Adicionar Banner
            </button>
        </div>
    </div>
</div>

<!-- Add/Edit Modal -->
<nz-modal [(nzVisible)]="isModalVisible" [nzTitle]="editingBanner ? 'Editar Banner' : 'Novo Banner'"
    [nzFooter]="modalFooter" (nzOnCancel)="closeModal()" nzWidth="640px" nzCentered>
    <ng-container *nzModalContent>
        <div class="banner-form">
            <!-- Image Upload Section -->
            <div class="form-section">
                <label class="form-label required">Imagem do Banner</label>
                <nz-upload nzType="drag" [nzCustomRequest]="handleUpload" [nzShowUploadList]="false"
                    class="banner-upload" [class.has-image]="bannerForm.imageUrl">
                    <div class="upload-content">
                        @if (bannerForm.imageUrl) {
                        <div class="preview-container">
                            <img [src]="bannerForm.imageUrl" alt="Preview" class="upload-preview" />
                            <div class="preview-overlay">
                                <span nz-icon nzType="camera" class="overlay-icon"></span>
                                <span>Alterar imagem</span>
                            </div>
                        </div>
                        } @else {
                        <div class="upload-placeholder">
                            <span nz-icon nzType="cloud-upload" class="upload-icon"></span>
                            <p class="upload-text">Arraste ou clique para upload</p>
                            <p class="upload-hint">
                                <strong>Dimensão:</strong> 1920 × 600 pixels<br>
                                <strong>Formatos:</strong> JPG, PNG ou WebP
                            </p>
                        </div>
                        }
                    </div>
                </nz-upload>
            </div>

            <!-- Title & Subtitle Section -->
            <div class="form-row">
                <div class="form-section flex-1">
                    <label class="form-label">Título</label>
                    <input nz-input [(ngModel)]="bannerForm.title" placeholder="Ex: Transforme sua carreira"
                        maxlength="60" />
                    <span class="input-hint">{{ (bannerForm.title || '').length }}/60 caracteres</span>
                </div>
            </div>

            <div class="form-section">
                <label class="form-label">Subtítulo</label>
                <input nz-input [(ngModel)]="bannerForm.subtitle" placeholder="Ex: Cursos profissionais com certificado"
                    maxlength="100" />
                <span class="input-hint">{{ (bannerForm.subtitle || '').length }}/100 caracteres</span>
            </div>

            <!-- Info Note -->
            <div class="info-note">
                <span nz-icon nzType="info-circle"></span>
                <span>Os banners direcionam automaticamente para a página de formações.</span>
            </div>
        </div>
    </ng-container>
    <ng-template #modalFooter>
        <div class="modal-footer">
            <button nz-button nzType="default" (click)="closeModal()">Cancelar</button>
            <button nz-button nzType="primary" (click)="saveBanner()" [disabled]="!bannerForm.imageUrl"
                [nzLoading]="isLoading">
                <span nz-icon nzType="check"></span>
                {{ editingBanner ? 'Salvar Alterações' : 'Criar Banner' }}
            </button>
        </div>
    </ng-template>
</nz-modal>